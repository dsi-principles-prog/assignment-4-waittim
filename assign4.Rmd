---
title: "assign4"
output: html_notebook
---


For the regular expression exercises, try writing first using regular expressions directly, then try using rverbalexpressions. Provide the code for both. 

```{r libraries}
library(lubridate)
library(stringr)
library(RVerbalExpressions)
```


# Part 1

## R4DS 16.4.5

**Create a vector of dates giving the first day of every month in the current year. **
```{r generate year}
ymd_v <- ymd(str_c(year(now()), ",", seq(1, 12, 1), ",01"))
ymd_v
```


**Write a function that given your birthday (as a date), returns how old you are in years.**

```{r calculate age}
count_age <- function(x){
  age <- year(now())-year(ymd(x))
  age
}
count_age(19960406)
```


**Write a function that given your birthday, returns the day of the week you were born on. **

```{r calculate weekday}
call_week <- function(x){
  weekday <- wday(ymd(x),label = T)
  weekday
}
call_week(19960406)
```


## R4DS 14.3.2.1

**Given the corpus of common words in stringr::words, create regular expressions that find all words that have seven letters or more. (Since this list is long, you might want to use the match argument to str_view() to show only the matching or non-matching words.)**

```{r import data, include=FALSE}
stringr::words
```

```{r more than 7}
str_view(words, "\\w{7,}", match = TRUE)

morethan7 <- rx() %>%
  rx_word_char() %>%
  rx_repeat_previous(7) %>%
  rx_anything()
morethan7

str_view(words, morethan7, match = TRUE)

```


## R4DS 14.3.3.1

**Use str_detect to find all words that:**

**That only contain consonants. (Hint: thinking about matching “not”-vowels.)**

```{r only consonants}
words[str_detect(words, "^[^aeiou]+$") ]

consonants_only <- rx() %>%
  rx_start_of_line() %>%
  rx_something_but("aeiou") %>%
  rx_end_of_line()
consonants_only

words[str_detect(words, consonants_only) ]

```

**Empirically verify the rule “i before e except after c”.**

```{r no c before ie}
words[str_detect(words, "[^c]ie")]

nc_ie <- rx() %>%
  rx_something_but("c") %>%
  rx_find("ie")
nc_ie

words[str_detect(words, nc_ie)]

```

**Create a regular expression that will match telephone numbers as commonly written in the US. Split this up into multiple expressions as needed.**

```{r telephone number}

telen <- rx() %>%
  rx_start_of_line() %>%
  rx_maybe("(") %>%
  rx_digit() %>%
  rx_repeat_previous(3) %>%
  rx_maybe(")") %>%
  rx_any_of(" .-") %>%
  rx_digit() %>%
  rx_repeat_previous(3) %>%
  rx_any_of(" .-") %>%
  rx_digit() %>%
  rx_repeat_previous(4) %>%
  rx_end_of_line() 
telen

phonenum <- c("(615) 972-0128","(615) 481.3147","66z.777 8888")

phonenum[str_detect(phonenum, "^(\\()?[0-9]{3}(\\))?[ -\\.][0-9]{3}[ -\\.][0-9]{4}$")]

phonenum[str_detect(phonenum, telen)]

```




# Part 2


Choose a dataset (this can be the same dataset as the last assignment, or a new one). Define a predictive modeling problem. Create the appropriate files and notebooks to do the following:

```{r libraries2, include=FALSE}
library(readr)
library(janitor)
library(assertr)
library(tidyverse)
```

1. Describe the data and the problem
```{r import part2 data, include=FALSE}
USvideos <- read_csv("USvideos.csv") %>%
  clean_names()
```

This dataset comes from Kaggle Competitions, includes several months (and counting) of data on daily trending YouTube videos. Data is for the US with up to 200 listed trending videos per day.

```{r}
dim(USvideos)
str(USvideos)
```

Data includes the video title, channel title, publish time, tags, views, likes and dislikes, description, and comment count.


2. Read in and check data

```{r}
assert(data = USvideos, in_set(1, 43, allow.na = FALSE), category_id) 
```

```{r}
assert(data = USvideos, within_bounds(lower.bound = 0, upper.bound = Inf, allow.na = FALSE), views)
```


```{r}
assert(data = USvideos, within_bounds(lower.bound = 0,upper.bound = Inf, allow.na = FALSE), likes)
```


```{r}
assert(data = USvideos, within_bounds(lower.bound = 0, upper.bound = Inf, allow.na = FALSE), dislikes)
```


```{r}
assert(data = USvideos, within_bounds(lower.bound = 0, upper.bound = Inf, allow.na = FALSE), comment_count)
```


```{r}
assert(data = USvideos, in_set(TRUE, FALSE, allow.na = FALSE), comments_disabled)
```


```{r}
assert(data = USvideos, in_set(TRUE, FALSE, allow.na = FALSE), ratings_disabled)
```


```{r}
assert(data = USvideos, in_set(TRUE, FALSE, allow.na = FALSE), video_error_or_removed) 
```

```{r}
class(USvideos$trending_date)
class(USvideos$category_id)
class(USvideos$publish_time)
class(USvideos$comments_disabled)
class(USvideos$ratings_disabled)
class(USvideos$video_error_or_removed)
```


3. Clean up the data. 

```{r}
USvideos_NNA <- as.data.frame(na.omit(USvideos))
USvideos_NNA
```

```{r}
USvideos_NNA <- USvideos_NNA %>%
  mutate(trending_date = ydm(trending_date))
```

```{r}
USvideos_NNA[["category_id"]] <- factor(USvideos_NNA[["category_id"]])
class(USvideos_NNA$trending_date)
```



*Note: You may request that score for these sections replace your score for the coding portion of Assignment 3.*

4. Using best practices, write four functions which add engineered features to the dataset, including a description and rationale. Include a test to determine whether the features are working as intended. 

```{r}
get_time_point <- function(df, time_column){
  library(tidyverse)
  if(class(df[[time_column]])==c("POSIXct", "POSIXt") | class(df[[time_column]])=="Date"){
    print("Date format check done.")
  }else{
      stop("Not a date format, please use 'lubridate' package.")
  }
  # year_col_name <- str_c(as.character(df$time_column),"_year")
  # month_col_name <- str_c(as.character(df$time_column),"_month")
  # day_col_name <- str_c(as.character(df$time_column),"_day")
  # hour_col_name <- str_c(as.character(df$time_column),"_hour")
  # minute_col_name <- str_c(as.character(df$time_column),"_minute")
  # second_col_name <- str_c(as.character(df$time_column),"_second")
  if(class(df[[time_column]])=="Date"){
    df <- df %>%
      mutate_at({{time_column}}, list(year=years, month=months, day=days ))
  }else{
    df <- df %>%
      mutate(year_col_name = years({{time_column}}),
             month_col_name = months({{time_column}}),
             day_col_name = days({{time_column}}),
             hour_col_name = hours({{time_column}}),
             minute_col_name = minutes({{time_column}}),
             second_col_name = seconds({{time_column}}))
  }
  df
}
```

```{r}
get_time_point(USvideos_NNA,"trending_date")
```

```{r}
head(USvideos_NNA)
```


```{r}
df <- mutate_at(USvideos_NNA, trending_date, list(year=years, month=monsth, day=days ))
df
get_time_point(USvideos_NNA, trending_date)
```

```{r}
# get_time_point <- function(df, time_column){
#   df[time_column]
#   class(df[[time_column]]) == "Date" #| class(df$time_column)==c("POSIXct", "POSIXt")
# }
# get_time_point(USvideos_NNA, "trending_date")
# 
# class(USvideos_NNA$trending_date) == "Date"
# 
# class(USvideos_NNA$trending_date)
```



```{r}
count_rows <- function(df, chr_column){
  library(tidyverse)
  if(class(df[[chr_column]]) == "character"){
    print("Character format check done.")
  }else{
    stop("Not a charater format.")
  }
  new_col_name <- paste0({{chr_column}},"_row_num")
  df %>%
    mutate(new_col_name = str_count({{chr_column}}, "\n") + 1)
}
```

```{r}
count_rows(USvideos_NNA, description)
```


```{r}
count_tags <- function(df, tag_column){
  library(tidyverse)
  if(class(df[[tag_column]]) == "character"){
    print("Character format check done.")
  }else{
    stop("Not a charater format.")
  }
  new_col_name <- paste0({{tag_column}},"_tag_num")
  df %>%
    mutate(new_col_name = str_count({{tag_column}}, '"|"') + 1)
}
```

```{r}
get_chr_length <- function(df, chr_column){
  if(class(df[[chr_column]]) == "character"){
    print("Character format check done.")
  }else{
    stop("Not a charater format.")
  }
  new_col_name <- paste0({{chr_column}},"_length")
  df %>%
    mutate(new_col_name = nchar({{chr_column}}))
}
```

```{r}
get_ratio <- function(numerator, denominator){
  if(class(df[[numerator]]) == "double" & class(df[[denominator]]) == "double"){
    print("numerical format check done.")
  }else{
    stop("Not a numerical format.")
  }
  new_col_name <- stringr::str_c({{numerator}},"/",{{denominator}},"_ratio")
  df %>%
    mutate(new_col_name = {{numerator}}/{{denominator}})
}
```





5. Prepare the data for modeling




Note: this will form the basis for your midterm project. Take advantage of TA's and my office hours. We can provide feedback and guidance. 

